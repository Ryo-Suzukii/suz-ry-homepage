<template>
  <div class="relative w-full bg-black text-white" style="min-height: 800vh;">
    <!-- 3Då®‡å®™ã‚·ãƒ¼ãƒ³ -->
    <div ref="spaceContainer" class="fixed inset-0 z-0" />
    
    <!-- ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <div class="relative z-10">
      <!-- ã‚»ã‚¯ã‚·ãƒ§ãƒ³1: å†¥ç‹æ˜Ÿ -->
      <section class="h-screen flex items-center justify-center" data-planet="pluto">
        <div class="text-center animate-fade-in">
          <div class="text-8xl mb-8">ğŸª</div>
          <h1 class="text-6xl font-bold mb-6 text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-blue-400">
            Profile Journey
          </h1>
          <p class="text-xl text-gray-300 mb-8">å†¥ç‹æ˜Ÿã‹ã‚‰ã®æ—…ã‚’å§‹ã‚ã¾ã—ã‚‡ã†</p>
          <div class="text-sm text-gray-500">ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ã¦å®‡å®™ã‚’æ—…ã—ã¦ãã ã•ã„</div>
        </div>
      </section>

      <!-- ã‚»ã‚¯ã‚·ãƒ§ãƒ³2: æµ·ç‹æ˜Ÿ -->
      <section class="h-screen flex items-center justify-center" data-planet="neptune">
        <div class="max-w-2xl text-center">
          <div class="text-6xl mb-6">ğŸ”µ</div>
          <h2 class="text-4xl font-bold mb-6 text-cyan-400">æµ·ç‹æ˜Ÿ - æ¢ç©¶å¿ƒ</h2>
          <div class="bg-black/50 backdrop-blur-sm rounded-xl p-8 border border-cyan-400/30">
            <p class="text-lg leading-relaxed mb-4">
              æœ€ã‚‚é ã„æƒ‘æ˜Ÿã®ã‚ˆã†ã«ã€å¸¸ã«æ–°ã—ã„çŸ¥è­˜ã®å¢ƒç•Œã‚’æ±‚ã‚ã¦ã„ã¾ã™ã€‚
            </p>
            <p class="text-gray-300">
              æœªçŸ¥ã®æŠ€è¡“é ˜åŸŸã¸ã®æ¢æ±‚å¿ƒã¨ã€æ·±ã„ç†è§£ã‚’è¿½æ±‚ã™ã‚‹å§¿å‹¢ãŒç§ã®åŸå‹•åŠ›ã§ã™ã€‚
            </p>
          </div>
        </div>
      </section>

      <!-- ã‚»ã‚¯ã‚·ãƒ§ãƒ³3: å¤©ç‹æ˜Ÿ -->
      <section class="h-screen flex items-center justify-center" data-planet="uranus">
        <div class="max-w-2xl text-center">
          <div class="text-6xl mb-6">ğŸŒ€</div>
          <h2 class="text-4xl font-bold mb-6 text-blue-400">å¤©ç‹æ˜Ÿ - é©æ–°æ€§</h2>
          <div class="bg-black/50 backdrop-blur-sm rounded-xl p-8 border border-blue-400/30">
            <p class="text-lg leading-relaxed mb-4">
              ç‹¬ç‰¹ãªè‡ªè»¢è»¸ã‚’æŒã¤å¤©ç‹æ˜Ÿã®ã‚ˆã†ã«ã€å¾“æ¥ã¨ã¯ç•°ãªã‚‹è¦–ç‚¹ã§ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã—ã¾ã™ã€‚
            </p>
            <p class="text-gray-300">
              æ—¢å­˜ã®æ çµ„ã¿ã«ã¨ã‚‰ã‚ã‚Œãªã„é©æ–°çš„ãªã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç”Ÿã¿å‡ºã™ã“ã¨ã‚’é‡è¦–ã—ã¦ã„ã¾ã™ã€‚
            </p>
          </div>
        </div>
      </section>

      <!-- ã‚»ã‚¯ã‚·ãƒ§ãƒ³4: åœŸæ˜Ÿ -->
      <section class="h-screen flex items-center justify-center" data-planet="saturn">
        <div class="max-w-2xl text-center">
          <div class="text-6xl mb-6">ğŸª</div>
          <h2 class="text-4xl font-bold mb-6 text-yellow-400">åœŸæ˜Ÿ - ä½“ç³»åŒ–</h2>
          <div class="bg-black/50 backdrop-blur-sm rounded-xl p-8 border border-yellow-400/30">
            <p class="text-lg leading-relaxed mb-4">
              ç¾ã—ã„ãƒªãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ã®ã‚ˆã†ã«ã€æ•´ç†ã•ã‚ŒãŸçŸ¥è­˜ä½“ç³»ã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚
            </p>
            <p class="text-gray-300">
              è¤‡é›‘ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚‚ä½“ç³»çš„ã«ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã—ã€ä¿å®ˆæ€§ã®é«˜ã„ã‚·ã‚¹ãƒ†ãƒ ã‚’è¨­è¨ˆã—ã¾ã™ã€‚
            </p>
          </div>
        </div>
      </section>

      <!-- ã‚»ã‚¯ã‚·ãƒ§ãƒ³5: æœ¨æ˜Ÿ -->
      <section class="h-screen flex items-center justify-center" data-planet="jupiter">
        <div class="max-w-2xl text-center">
          <div class="text-6xl mb-6">ğŸŸ¤</div>
          <h2 class="text-4xl font-bold mb-6 text-orange-400">æœ¨æ˜Ÿ - ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—</h2>
          <div class="bg-black/50 backdrop-blur-sm rounded-xl p-8 border border-orange-400/30">
            <p class="text-lg leading-relaxed mb-4">
              å¤ªé™½ç³»æœ€å¤§ã®æƒ‘æ˜Ÿã¨ã—ã¦ã€ãƒãƒ¼ãƒ ã‚’ç‰½å¼•ã™ã‚‹åŠ›ã‚’æŒã£ã¦ã„ã¾ã™ã€‚
            </p>
            <p class="text-gray-300">
              å¤§ããªè¦–é‡ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã‚’ä¿¯ç°ã—ã€ãƒ¡ãƒ³ãƒãƒ¼ã‚’é©åˆ‡ãªæ–¹å‘ã¸å°ãã¾ã™ã€‚
            </p>
          </div>
        </div>
      </section>

      <!-- ã‚»ã‚¯ã‚·ãƒ§ãƒ³6: ç«æ˜Ÿ -->
      <section class="h-screen flex items-center justify-center" data-planet="mars">
        <div class="max-w-2xl text-center">
          <div class="text-6xl mb-6">ğŸ”´</div>
          <h2 class="text-4xl font-bold mb-6 text-red-400">ç«æ˜Ÿ - æƒ…ç†±</h2>
          <div class="bg-black/50 backdrop-blur-sm rounded-xl p-8 border border-red-400/30">
            <p class="text-lg leading-relaxed mb-4">
              èµ¤ã„æƒ‘æ˜Ÿã®æƒ…ç†±ã§ã€å›°é›£ãªèª²é¡Œã«ã‚‚æœæ•¢ã«æŒ‘æˆ¦ã—ã¾ã™ã€‚
            </p>
            <p class="text-gray-300">
              ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼ã¸ã®æƒ…ç†±ã‚’åŸå‹•åŠ›ã«ã€å¸¸ã«å“è³ªã®é«˜ã„ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’è¿½æ±‚ã—ã¾ã™ã€‚
            </p>
          </div>
        </div>
      </section>

      <!-- ã‚»ã‚¯ã‚·ãƒ§ãƒ³7: åœ°çƒ -->
      <section class="h-screen flex items-center justify-center" data-planet="earth">
        <div class="max-w-4xl text-center">
          <div class="text-8xl mb-8">ğŸŒ</div>
          <h2 class="text-5xl font-bold mb-8 text-green-400">åœ°çƒ - ãƒ›ãƒ¼ãƒ </h2>
          <div class="bg-black/50 backdrop-blur-sm rounded-xl p-8 border border-green-400/30">
            <p class="text-2xl leading-relaxed mb-8">
              é•·ã„æ—…ã‚’çµŒã¦ã€æœ€çµ‚çš„ã«ãŸã©ã‚Šç€ãã®ã¯ã€Œäººã€ã®ãŸã‚ã®ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼ã€‚
            </p>
            
            <!-- å€‹äººæƒ…å ±ã‚«ãƒ¼ãƒ‰ -->
            <div class="grid md:grid-cols-3 gap-8 mb-8">
              <div class="bg-gray-800/50 rounded-lg p-6">
                <h3 class="text-lg font-semibold mb-3 text-green-400">åŸºæœ¬æƒ…å ±</h3>
                <div class="space-y-2 text-left">
                  <div class="flex justify-between">
                    <span class="text-gray-400">åå‰:</span>
                    <span>Full Stack Engineer</span>
                  </div>
                  <div class="flex justify-between">
                    <span class="text-gray-400">å°‚é–€:</span>
                    <span>Web Development</span>
                  </div>
                  <div class="flex justify-between">
                    <span class="text-gray-400">çµŒé¨“:</span>
                    <span>4+ Years</span>
                  </div>
                </div>
              </div>
              
              <div class="bg-gray-800/50 rounded-lg p-6">
                <h3 class="text-lg font-semibold mb-3 text-green-400">èˆˆå‘³ãƒ»é–¢å¿ƒ</h3>
                <div class="space-y-2 text-sm">
                  <div class="bg-gray-700 rounded px-2 py-1">ğŸŒŒ å®‡å®™ãƒ»å¤©ä½“ç‰©ç†å­¦</div>
                  <div class="bg-gray-700 rounded px-2 py-1">ğŸ¤– äººå·¥çŸ¥èƒ½ãƒ»æ©Ÿæ¢°å­¦ç¿’</div>
                  <div class="bg-gray-700 rounded px-2 py-1">ğŸ® ã‚²ãƒ¼ãƒ é–‹ç™º</div>
                  <div class="bg-gray-700 rounded px-2 py-1">ğŸµ éŸ³æ¥½ãƒ»DTM</div>
                </div>
              </div>
              
              <div class="bg-gray-800/50 rounded-lg p-6">
                <h3 class="text-lg font-semibold mb-3 text-green-400">ç›®æ¨™ãƒ»ãƒ“ã‚¸ãƒ§ãƒ³</h3>
                <div class="space-y-2 text-sm text-left">
                  <div>â€¢ ã‚ˆã‚Šè‰¯ã„UXã®è¿½æ±‚</div>
                  <div>â€¢ æŠ€è¡“ã®ç¤¾ä¼šå®Ÿè£…</div>
                  <div>â€¢ æŒç¶šå¯èƒ½ãªé–‹ç™º</div>
                  <div>â€¢ çŸ¥è­˜ã®å…±æœ‰ãƒ»æ•™è‚²</div>
                </div>
              </div>
            </div>

            <div class="text-gray-300">
              å®‡å®™ã®åºƒã•ã«æ¯”ã¹ã‚Œã°å°ã•ãªå­˜åœ¨ã§ã™ãŒã€<br>
              ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼ã§äººã€…ã®ç”Ÿæ´»ã‚’ã‚ˆã‚Šè±Šã‹ã«ã™ã‚‹ã“ã¨ãŒç§ã®ä½¿å‘½ã§ã™ã€‚
            </div>
          </div>
        </div>
      </section>

      <!-- æœ€çµ‚ã‚»ã‚¯ã‚·ãƒ§ãƒ³: Contact -->
      <section class="h-screen flex items-center justify-center" data-planet="contact">
        <div class="text-center">
          <div class="text-6xl mb-8">ğŸ“¡</div>
          <h2 class="text-4xl font-bold mb-8 text-purple-400">Contact</h2>
          <p class="text-xl text-gray-300 mb-8">å®‡å®™ã®æ—…ã¯ã“ã“ã§çµ‚ã‚ã‚Šã§ã™ãŒã€<br>æ–°ãŸãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å§‹ã¾ã‚Šã‹ã‚‚ã—ã‚Œã¾ã›ã‚“</p>
          <div class="flex justify-center gap-8">
            <router-link to="/contact" class="px-8 py-4 bg-purple-600 hover:bg-purple-700 rounded-lg transition-colors text-lg font-semibold">
              ãŠå•ã„åˆã‚ã›
            </router-link>
            <router-link to="/" class="px-8 py-4 bg-gray-700 hover:bg-gray-600 rounded-lg transition-colors text-lg font-semibold">
              ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹
            </router-link>
          </div>
        </div>
      </section>
    </div>

    <!-- ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ -->
    <div class="fixed top-4 right-4 z-20">
      <div class="w-16 h-16 relative">
        <svg class="transform -rotate-90 w-full h-full">
          <circle
            cx="32"
            cy="32"
            r="28"
            stroke="currentColor"
            stroke-width="4"
            fill="transparent"
            class="text-gray-700"
          />
          <circle
            cx="32"
            cy="32"
            r="28"
            stroke="currentColor"
            stroke-width="4"
            fill="transparent"
            class="text-purple-400 transition-all duration-300"
            :stroke-dasharray="circumference"
            :stroke-dashoffset="circumference - (scrollProgress / 100) * circumference"
          />
        </svg>
        <div class="absolute inset-0 flex items-center justify-center text-xs font-bold">
          {{ Math.round(scrollProgress) }}%
        </div>
      </div>
    </div>

    <!-- ç¾åœ¨ã®æƒ‘æ˜Ÿè¡¨ç¤º -->
    <div class="fixed bottom-4 left-4 z-20 bg-black/50 backdrop-blur-sm rounded-lg px-4 py-2">
      <div class="flex items-center gap-3">
        <span class="text-2xl">{{ currentPlanetIcon }}</span>
        <span class="text-sm">{{ currentPlanetName }}</span>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, onMounted, onUnmounted, computed } from 'vue'
import * as THREE from 'three'

const spaceContainer = ref(null)
const scrollProgress = ref(0)
const currentSection = ref(0)

let scene, camera, renderer, planets = [], stars, animationId
let isScrolling = false

const circumference = computed(() => 2 * Math.PI * 28)

const planetData = [
  { name: 'å†¥ç‹æ˜Ÿ', icon: 'ğŸª', color: 0x8B4CBE, distance: 1000 },
  { name: 'æµ·ç‹æ˜Ÿ', icon: 'ğŸ”µ', color: 0x0077BE, distance: 800 },
  { name: 'å¤©ç‹æ˜Ÿ', icon: 'ğŸŒ€', color: 0x4FD0E4, distance: 600 },
  { name: 'åœŸæ˜Ÿ', icon: 'ğŸª', color: 0xFFD700, distance: 400 },
  { name: 'æœ¨æ˜Ÿ', icon: 'ğŸŸ¤', color: 0xD8CA9D, distance: 200 },
  { name: 'ç«æ˜Ÿ', icon: 'ğŸ”´', color: 0xFF6B35, distance: 100 },
  { name: 'åœ°çƒ', icon: 'ğŸŒ', color: 0x6B93D6, distance: 0 },
  { name: 'Contact', icon: 'ğŸ“¡', color: 0x9333EA, distance: -100 }
]

const currentPlanetIcon = computed(() => planetData[currentSection.value]?.icon || 'ğŸŒŒ')
const currentPlanetName = computed(() => planetData[currentSection.value]?.name || 'Deep Space')

function initThreeJS() {
  if (!spaceContainer.value) return

  scene = new THREE.Scene()
  camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 2000)
  renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true })
  
  renderer.setSize(window.innerWidth, window.innerHeight)
  renderer.setClearColor(0x000000, 1)
  spaceContainer.value.appendChild(renderer.domElement)

  // æ˜Ÿç©ºèƒŒæ™¯
  createStarField()
  
  // æƒ‘æ˜Ÿã‚’ä½œæˆ
  createPlanets()

  camera.position.set(0, 0, 1000)
  camera.lookAt(0, 0, 0)

  animate()
}

function createStarField() {
  // é€šå¸¸ã®æ˜Ÿ
  const starGeometry = new THREE.BufferGeometry()
  const starCount = 3000
  const positions = new Float32Array(starCount * 3)
  const colors = new Float32Array(starCount * 3)
  const sizes = new Float32Array(starCount)

  for (let i = 0; i < starCount; i++) {
    // ã‚ˆã‚Šåºƒç¯„å›²ã«æ˜Ÿã‚’é…ç½®
    positions[i * 3] = (Math.random() - 0.5) * 6000
    positions[i * 3 + 1] = (Math.random() - 0.5) * 6000
    positions[i * 3 + 2] = (Math.random() - 0.5) * 6000

    // ã‚ˆã‚Šå¤šå½©ãªè‰²åˆã„ã®æ˜Ÿ
    const color = new THREE.Color()
    const hue = Math.random()
    if (Math.random() > 0.8) {
      // 20%ã®ç¢ºç‡ã§ç‰¹åˆ¥ãªè‰²ã®æ˜Ÿï¼ˆé’ã€èµ¤ã€ã‚ªãƒ¬ãƒ³ã‚¸ï¼‰
      color.setHSL(Math.random() > 0.5 ? 0.6 : Math.random() > 0.5 ? 0.05 : 0.1, 0.8, 0.9)
    } else {
      // é€šå¸¸ã®ç™½ã„æ˜Ÿ
      color.setHSL(0.1, 0.1, Math.random() * 0.4 + 0.6)
    }
    
    colors[i * 3] = color.r
    colors[i * 3 + 1] = color.g
    colors[i * 3 + 2] = color.b
    
    // ã‚µã‚¤ã‚ºã‚’å¤‰åŒ–ã•ã›ã‚‹
    sizes[i] = Math.random() * 3 + 0.5
  }

  starGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3))
  starGeometry.setAttribute('color', new THREE.BufferAttribute(colors, 3))
  starGeometry.setAttribute('size', new THREE.BufferAttribute(sizes, 1))
  
  const starMaterial = new THREE.PointsMaterial({
    size: 2,
    vertexColors: true,
    transparent: true,
    opacity: 0.9,
    sizeAttenuation: true
  })

  stars = new THREE.Points(starGeometry, starMaterial)
  scene.add(stars)

  // è¼ãæ˜Ÿåº§ã‚’è¿½åŠ 
  createBrightStars()
  
  // éŠ€æ²³ç³»ã®æ¸¦ã‚’è¿½åŠ 
  createGalaxySpiral()
  
  // æµã‚Œæ˜Ÿã‚’è¿½åŠ 
  createShootingStars()
}

function createBrightStars() {
  // ç‰¹åˆ¥ã«æ˜ã‚‹ã„æ˜Ÿã‚’è¿½åŠ 
  const brightStarCount = 50
  const brightGeometry = new THREE.BufferGeometry()
  const brightPositions = new Float32Array(brightStarCount * 3)
  const brightColors = new Float32Array(brightStarCount * 3)

  for (let i = 0; i < brightStarCount; i++) {
    brightPositions[i * 3] = (Math.random() - 0.5) * 5000
    brightPositions[i * 3 + 1] = (Math.random() - 0.5) * 5000
    brightPositions[i * 3 + 2] = (Math.random() - 0.5) * 5000

    const color = new THREE.Color()
    // ãƒ–ãƒ«ãƒ¼ã€ã‚´ãƒ¼ãƒ«ãƒ‰ã€ãƒ¬ãƒƒãƒ‰ã®æ˜ã‚‹ã„æ˜Ÿ
    const colorType = Math.random()
    if (colorType < 0.4) {
      color.setHSL(0.6, 0.8, 1.0) // ãƒ–ãƒ«ãƒ¼
    } else if (colorType < 0.7) {
      color.setHSL(0.15, 0.8, 1.0) // ã‚´ãƒ¼ãƒ«ãƒ‰
    } else {
      color.setHSL(0.0, 0.8, 1.0) // ãƒ¬ãƒƒãƒ‰
    }
    
    brightColors[i * 3] = color.r
    brightColors[i * 3 + 1] = color.g
    brightColors[i * 3 + 2] = color.b
  }

  brightGeometry.setAttribute('position', new THREE.BufferAttribute(brightPositions, 3))
  brightGeometry.setAttribute('color', new THREE.BufferAttribute(brightColors, 3))
  
  const brightMaterial = new THREE.PointsMaterial({
    size: 8,
    vertexColors: true,
    transparent: true,
    opacity: 0.8,
    sizeAttenuation: true
  })

  const brightStars = new THREE.Points(brightGeometry, brightMaterial)
  scene.add(brightStars)
  
  // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã«è¿½åŠ 
  planets.push(brightStars)
}

function createGalaxySpiral() {
  // éŠ€æ²³ç³»ã®æ¸¦çŠ¶æ§‹é€ 
  const spiralGeometry = new THREE.BufferGeometry()
  const spiralCount = 1000
  const spiralPositions = new Float32Array(spiralCount * 3)
  const spiralColors = new Float32Array(spiralCount * 3)

  for (let i = 0; i < spiralCount; i++) {
    const angle = (i / spiralCount) * Math.PI * 4 // 2å›è»¢
    const radius = (i / spiralCount) * 1500 + 200
    const height = (Math.random() - 0.5) * 100

    spiralPositions[i * 3] = Math.cos(angle) * radius
    spiralPositions[i * 3 + 1] = height
    spiralPositions[i * 3 + 2] = Math.sin(angle) * radius

    // éŠ€æ²³ä¸­å¿ƒã«å‘ã‹ã£ã¦è‰²ã‚’å¤‰åŒ–
    const color = new THREE.Color()
    const distanceRatio = i / spiralCount
    if (distanceRatio < 0.3) {
      color.setHSL(0.15, 0.9, 0.9) // ä¸­å¿ƒéƒ¨ã¯ã‚´ãƒ¼ãƒ«ãƒ‰
    } else if (distanceRatio < 0.6) {
      color.setHSL(0.6, 0.7, 0.8) // ä¸­é–“éƒ¨ã¯ãƒ–ãƒ«ãƒ¼
    } else {
      color.setHSL(0.65, 0.5, 0.7) // å¤–å´ã¯è–„ã„ãƒ–ãƒ«ãƒ¼
    }
    
    spiralColors[i * 3] = color.r
    spiralColors[i * 3 + 1] = color.g
    spiralColors[i * 3 + 2] = color.b
  }

  spiralGeometry.setAttribute('position', new THREE.BufferAttribute(spiralPositions, 3))
  spiralGeometry.setAttribute('color', new THREE.BufferAttribute(spiralColors, 3))
  
  const spiralMaterial = new THREE.PointsMaterial({
    size: 3,
    vertexColors: true,
    transparent: true,
    opacity: 0.6,
    sizeAttenuation: true
  })

  const spiralStars = new THREE.Points(spiralGeometry, spiralMaterial)
  spiralStars.rotation.x = Math.PI / 6 // å°‘ã—å‚¾ã‘ã‚‹
  scene.add(spiralStars)
  
  // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã«è¿½åŠ 
  planets.push(spiralStars)
}

function createShootingStars() {
  // æµã‚Œæ˜Ÿç”¨ã®ç·šåˆ†ã‚’ä½œæˆ
  const shootingStarCount = 8
  
  for (let i = 0; i < shootingStarCount; i++) {
    const geometry = new THREE.BufferGeometry()
    const positions = new Float32Array(6) // 2ç‚¹ã®åº§æ¨™
    
    // ãƒ©ãƒ³ãƒ€ãƒ ãªé–‹å§‹ä½ç½®
    const startX = (Math.random() - 0.5) * 4000
    const startY = (Math.random() - 0.5) * 4000
    const startZ = (Math.random() - 0.5) * 4000
    
    // æµã‚Œæ˜Ÿã®è»Œè·¡ã®é•·ã•
    const trailLength = 200
    const direction = new THREE.Vector3(
      (Math.random() - 0.5) * 2,
      (Math.random() - 0.5) * 2,
      (Math.random() - 0.5) * 2
    ).normalize()
    
    positions[0] = startX
    positions[1] = startY  
    positions[2] = startZ
    positions[3] = startX + direction.x * trailLength
    positions[4] = startY + direction.y * trailLength
    positions[5] = startZ + direction.z * trailLength
    
    geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3))
    
    const material = new THREE.LineBasicMaterial({
      color: Math.random() > 0.5 ? 0xffffff : 0x88ccff,
      transparent: true,
      opacity: 0.8
    })
    
    const shootingStar = new THREE.Line(geometry, material)
    
    // ãƒ©ãƒ³ãƒ€ãƒ ãªç§»å‹•é€Ÿåº¦ã¨ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆæ™‚é–“ã‚’è¨­å®š
    shootingStar.userData = {
      speed: Math.random() * 10 + 5,
      direction: direction.clone(),
      fadeTime: Math.random() * 3000 + 2000, // 2-5ç§’ã§ãƒ•ã‚§ãƒ¼ãƒ‰
      startTime: Date.now() + Math.random() * 5000 // 0-5ç§’å¾Œã«é–‹å§‹
    }
    
    scene.add(shootingStar)
    planets.push(shootingStar)
  }
}

function createPlanets() {
  planetData.forEach((planetInfo, index) => {
    const geometry = new THREE.SphereGeometry(20 + index * 5, 32, 32)
    const material = new THREE.MeshBasicMaterial({
      color: planetInfo.color,
      transparent: true,
      opacity: 0.8
    })

    const planet = new THREE.Mesh(geometry, material)
    planet.position.z = planetInfo.distance
    planet.position.x = (Math.random() - 0.5) * 200
    planet.position.y = (Math.random() - 0.5) * 200

    // æƒ‘æ˜Ÿã®ãƒªãƒ³ã‚°ï¼ˆåœŸæ˜Ÿç”¨ï¼‰
    if (index === 3) {
      const ringGeometry = new THREE.RingGeometry(30, 45, 32)
      const ringMaterial = new THREE.MeshBasicMaterial({
        color: 0xFFD700,
        transparent: true,
        opacity: 0.6,
        side: THREE.DoubleSide
      })
      const ring = new THREE.Mesh(ringGeometry, ringMaterial)
      ring.rotation.x = Math.PI / 2
      planet.add(ring)
    }

    scene.add(planet)
    planets.push(planet)
  })
}

function handleScroll() {
  if (isScrolling) return
  isScrolling = true

  const scrollTop = window.pageYOffset
  const docHeight = document.documentElement.scrollHeight - window.innerHeight
  const scrollPercent = scrollTop / docHeight
  
  scrollProgress.value = scrollPercent * 100
  currentSection.value = Math.floor(scrollPercent * planetData.length)
  
  // ã‚«ãƒ¡ãƒ©ä½ç½®ã‚’æ›´æ–°
  const targetZ = 1000 - (scrollPercent * 1100)
  camera.position.z = THREE.MathUtils.lerp(camera.position.z, targetZ, 0.1)

  // æƒ‘æ˜Ÿã®å›è»¢
  planets.forEach((planet, index) => {
    planet.rotation.y += 0.01 + index * 0.002
    planet.rotation.x += 0.005
    
    // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã«å¿œã˜ã¦é€æ˜åº¦ã‚’èª¿æ•´
    const distance = Math.abs(camera.position.z - planet.position.z)
    const opacity = Math.max(0.1, Math.min(1, 500 / distance))
    planet.material.opacity = opacity
  })

  setTimeout(() => {
    isScrolling = false
  }, 16)
}

function animate() {
  animationId = requestAnimationFrame(animate)
  
  const time = Date.now() * 0.001
  
  if (stars) {
    // æ˜Ÿå…¨ä½“ã‚’ã‚†ã£ãã‚Šã¨å›è»¢
    stars.rotation.y += 0.0003
    stars.rotation.x += 0.0001
  }

  planets.forEach((planet, index) => {
    if (planet.geometry && planet.geometry.attributes.position) {
      // æƒ‘æ˜Ÿã®å›è»¢
      planet.rotation.y += 0.002 + index * 0.001
      planet.rotation.x += 0.001
      
      // æµ®éŠåŠ¹æœï¼ˆã‚ˆã‚Šè¤‡é›‘ãªå‹•ãï¼‰
      planet.position.y += Math.sin(time * 0.5 + index) * 0.2
      planet.position.x += Math.cos(time * 0.3 + index) * 0.1
      
      // ç‰¹å®šã®æ˜Ÿï¼ˆæ˜ã‚‹ã„æ˜Ÿã‚„éŠ€æ²³ï¼‰ã«ã‚ˆã‚Šè¤‡é›‘ãªå‹•ãã‚’è¿½åŠ 
      if (index >= planetData.length) {
        // æ˜ã‚‹ã„æ˜Ÿã‚„éŠ€æ²³ã®å ´åˆ
        planet.rotation.z += 0.002
        
        // æ˜ã‚‹ã„æ˜Ÿã®ç¬ãåŠ¹æœ
        if (planet.material && planet.material.opacity !== undefined) {
          planet.material.opacity = 0.4 + Math.sin(time * 3 + index) * 0.4
        }
        
        // æµã‚Œæ˜Ÿã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
        if (planet.userData && planet.userData.speed) {
          const currentTime = Date.now()
          
          if (currentTime > planet.userData.startTime) {
            // æµã‚Œæ˜Ÿã‚’ç§»å‹•
            planet.position.add(planet.userData.direction.clone().multiplyScalar(planet.userData.speed))
            
            // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆåŠ¹æœ
            const elapsed = currentTime - planet.userData.startTime
            const fadeProgress = Math.min(elapsed / planet.userData.fadeTime, 1)
            
            if (planet.material) {
              planet.material.opacity = Math.max(0, 0.8 * (1 - fadeProgress))
            }
            
            // å®Œå…¨ã«ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆã—ãŸã‚‰ãƒªã‚»ãƒƒãƒˆ
            if (fadeProgress >= 1) {
              // æ–°ã—ã„ä½ç½®ã«ãƒªã‚»ãƒƒãƒˆ
              planet.position.set(
                (Math.random() - 0.5) * 4000,
                (Math.random() - 0.5) * 4000,
                (Math.random() - 0.5) * 4000
              )
              planet.userData.startTime = currentTime + Math.random() * 10000 // 0-10ç§’å¾Œã«å†é–‹
              if (planet.material) {
                planet.material.opacity = 0.8
              }
            }
          }
        }
      }
    } else {
      // é€šå¸¸ã®æƒ‘æ˜Ÿ
      planet.rotation.y += 0.001 + index * 0.0005
      planet.position.y += Math.sin(time + index) * 0.1
    }
  })

  renderer.render(scene, camera)
}

function handleResize() {
  if (camera && renderer) {
    camera.aspect = window.innerWidth / window.innerHeight
    camera.updateProjectionMatrix()
    renderer.setSize(window.innerWidth, window.innerHeight)
  }
}

onMounted(() => {
  initThreeJS()
  window.addEventListener('scroll', handleScroll, { passive: true })
  window.addEventListener('resize', handleResize)
})

onUnmounted(() => {
  if (animationId) {
    cancelAnimationFrame(animationId)
  }
  if (renderer && spaceContainer.value) {
    spaceContainer.value.removeChild(renderer.domElement)
  }
  window.removeEventListener('scroll', handleScroll)
  window.removeEventListener('resize', handleResize)
})
</script>

<style scoped>
.animate-fade-in {
  animation: fadeIn 2s ease-in-out;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(30px); }
  to { opacity: 1; transform: translateY(0); }
}

/* ã‚¹ãƒ ãƒ¼ã‚¹ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’æœ‰åŠ¹ã«ã™ã‚‹ */
html {
  scroll-behavior: smooth;
}

/* å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®é–“éš”ã‚’èª¿æ•´ */
section {
  scroll-snap-align: start;
}
</style>